<!DOCTYPE html>
<html lang="en">

<head>
  <script src="https://miro.com/app/static/sdk.1.1.js"></script>
  <script>

    const colores =
    {
      colorBoton = "#050B42",
    }
      ;
    const tiposFrame =
    {
      tipoframe = "FRAME",
      tipoLine = "LINE",
    };


    var widgets = [];

    miro.onReady(() => {
      miro.initialize({
        extensionPoints: {
          bottomBar: {
            title: 'Boton ada',
            svgIcon: '<circle cx="12" cy="12" r="9" fill="none" fill-rule="evenodd" stroke="currentColor" stroke-width="2"/>',
            onClick: () => {
              alert('HOLA MUNDO!')
            }
          },
          toolbar: {
            title: "Bot√≥n ADA",
            librarySvgIcon:
              '<circle cx="12" cy="12" r="9" fill="blue" fill-rule="evenodd" stroke="currentColor" stroke-width="2"/>',
            toolbarSvgIcon:
              '<circle cx="12" cy="12" r="9" fill="red" fill-rule="evenodd" stroke="currentColor" stroke-width="2"/>',
            onClick: () => {
              miro.showNotification("ADA dice HOlA!");
            },
          },
        }
      });
      (async () => {
        this.widgets = await miro.board.widgets.get();
        console.log("estos son mis wifgets", widgets);
      })();

      async function handleSelectionUpdated(event) {
        let widgetsHijos = [];

        if (event.data[0] && event.data[0].id) {
          let frame = widgets.find(widget => widget.type == tiposFrame.tipoframe && widget.childrenIds.includes(event.data[0].id));
          if (frame) {
            frame.childrenIds.forEach(idChildren => {
              let widgetHijo = widgets.find(widget => widget.id === idChildren);
              widgetsHijos.push(widgetHijo);
            });
          }
        }
        if (widgetsHijos && event.data[0] && event.data[0].id) {
          let lineaBtn = widgetsHijos.find(widget => widget.type == tiposFrame.tipoLine && (widget.startWidgetId ? widget.startWidgetId.id == event.data[0].id : false));
          if (lineaBtn) {
            let widgetActualizar = widgetsHijos.find(widget => widget.id == lineaBtn.endWidgetId);
          }
          console.log("widgets hijos encontrados", widgetsHijos);
          console.log("widgets A actualizar", widgetActualizar);
        }

        // if(event.data[0].id === "3074457358776878119"){
        //   setTimeout(() => {
        //     await miro.board.widgets.update({id: "3074457358776998742", text: 'Esta es la respuesta de ADA'})
        //   }, 2000);
        // }
      }
      miro.addListener('SELECTION_UPDATED', handleSelectionUpdated);
    });



  </script>
</head>

<body>
  <h1>aplicacion miro</h1>
  <img src="robot-corto.svg" />
</body>

</html>